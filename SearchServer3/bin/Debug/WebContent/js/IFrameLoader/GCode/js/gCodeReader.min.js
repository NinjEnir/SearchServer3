GCODE.gCodeReader=function(){var e,r,t={},a=[],n={x:void 0,y:void 0,z:void 0},o={x:void 0,y:void 0,z:void 0},l={x:void 0,y:void 0,z:void 0},d={},s={},m=0,f=0,u=0,c=0,y=0,p=0,g={},h="unknown",v={},z={},L={},S={},D={},_={sortLayers:!1,purgeEmptyLayers:!0,analyzeModel:!1,filamentType:"ABS",filamentDia:1.75,nozzleDia:.4},B=function(){var e=[],r=[];for(var i in t)e[t[i]]=i;e.sort(function(e,r){return e-r});for(var n=0;n<e.length;n++)"undefined"!=typeof t[e[n]]&&(r[n]=a[t[e[n]]]);a=r,delete r},C=function(){var e=!0;if(!a)return void console.log("Something terribly wrong just happened.");for(var r=0;r<a.length;r++){if(e=!0,"undefined"==typeof a[r])e=!0;else for(var t=0;t<a[r].length;t++)a[r][t].extrude&&(e=!1);e&&(a.splice(r,1),r--)}},x=function(e){var r=e.match(/extrusion_width_mm\s*=\s*(\d*\.\d+)/m);r&&(_.nozzleDia=r[1]);var t=e.match(/fiber_dia_mm\s*=\s*(\d*\.\d+)/m);t&&(_.filamentDia=t[1])},A=function(e){var r=e.match(/nozzle_diameter\s*=\s*(\d*\.\d+)/m);r&&(_.nozzleDia=r[1]);var t=e.match(/filament_diameter\s*=\s*(\d*\.\d+)/m);t&&(_.filamentDia=t[1])},w=function(e){var r=e.match(/nozzle_diameter\s*=\s*(\d*\.\d+)/m);r&&(_.nozzleDia=r[1]);var t=e.match(/Filament_Diameter_(mm)\s*:\s*(\d*\.\d+)/m);t&&(_.filamentDia=t[1])},T=function(){},F=function(e){var r=e.match(/CURA_PROFILE_STRING:((?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4}))/m);if(r){var t=window.atob(r[1]),a=new Uint8Array(new ArrayBuffer(t.length));for(i=0;i<t.length;i++)a[i]=t.charCodeAt(i);var n,o=new Zlib.inflate(a.subarray(2,a.byteLength-4));for(i=0;i<o.length;i+=1)n+=String.fromCharCode(o[i]);var l=n.match(/nozzle_size\s*=\s*(\d*\.\d+)/m);l&&(_.nozzleDia=l[1]);var d=n.match(/filament_diameter\s*=\s*(\d*\.\d+)/m);d&&(_.filamentDia=d[1])}},O=function(e){e.match(/Slic3r/)?(h="Slic3r",A(e)):e.match(/KISSlicer/)?(h="KISSlicer",x(e)):e.match(/skeinforge/)?(h="skeinforge",w(e)):e.match(/CURA_PROFILE_STRING/)?(h="cura",F(e)):e.match(/Miracle/)&&(h="makerbot",T(e))};return{loadFile:function(r){a=[],t=[],O(r.target.result),e=r.target.result.split(/\n/),r.target.result=null,GCODE.ui.worker.postMessage({cmd:"parseGCode",msg:{gcode:e,options:{firstReport:5}}}),delete e},setOption:function(e){for(var r in e)_[r]=e[r]},passDataToRenderer:function(){_.sortLayers&&B(),_.purgeEmptyLayers&&C(),GCODE.renderer.doRender(a,0),GCODE.renderer3d.setModel(a)},processLayerFromWorker:function(e){a[e.layerNum]=e.cmds,t[e.zHeightObject.zValue]=e.zHeightObject.layer},processMultiLayerFromWorker:function(e){for(var r=0;r<e.layerNum.length;r++)a[e.layerNum[r]]=e.model[e.layerNum[r]],t[e.zHeightObject.zValue[r]]=e.layerNum[r]},processAnalyzeModelDone:function(e){o=e.min,n=e.max,l=e.modelSize,m=e.totalFilament,d=e.filamentByLayer,s=e.filamentByExtruder,g=e.speeds,v=e.speedsByLayer,f=e.printTime,r=e.printTimeByLayer,c=e.layerHeight,y=e.layerCnt,p=e.layerTotal,z=e.volSpeeds,L=e.volSpeedsByLayer,S=e.extrusionSpeeds,D=e.extrusionSpeedsByLayer;var t=1;"ABS"===_.filamentType?t=1.04:"PLA"===_.filamentType&&(t=1.24),u=3.141*t*_.filamentDia/10*_.filamentDia/10/4*m/10,_.wh=parseFloat(_.nozzleDia)/parseFloat(c),("Slic3r"===h||"cura"===h)&&(_.wh=1.1*_.wh)},getLayerFilament:function(e){return d[e]},getLayerSpeeds:function(e){return v[e]?v[e]:{}},getModelInfo:function(){return{min:o,max:n,modelSize:l,totalFilament:m,filamentByExtruder:s,speeds:g,speedsByLayer:v,printTime:f,printTimeByLayer:r,totalWeight:u,layerHeight:c,layerCnt:y,layerTotal:p,volSpeeds:z,volSpeedsByLayer:L,extrusionSpeeds:S,extrusionSpeedsByLayer:D}},getGCodeLines:function(e,r,t){var i={first:a[e][r].gcodeLine,last:a[e][t].gcodeLine};return i},getOptions:function(){return _}}}();